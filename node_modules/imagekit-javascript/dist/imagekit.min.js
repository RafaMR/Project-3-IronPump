!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImageKit=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var a={message:"Missing urlEndpoint during SDK initialization",help:""},i={message:"Invalid transformationPosition parameter",help:""},s={message:"Missing file parameter for upload",help:""},u={message:"Missing fileName parameter for upload",help:""},p={message:"Missing authentication endpoint for upload",help:""},l={message:"Missing public key for upload",help:""},c={message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},f={message:"Request to authenticationEndpoint failed due to network error",help:""},d={message:"Invalid response from authenticationEndpoint. The SDK expects a JSON response with three fields i.e. signature, token and expire.",help:""},y={message:"Request to ImageKit upload endpoint failed due to network error",help:""},h={message:"Invalid uploadOptions parameter",help:""};function g(e,t,n){"function"==typeof n&&(e?n(t,null):n(null,t))}function m(e){var t={},n=e.getAllResponseHeaders();return Object.keys(n).length&&n.trim().split(/[\r\n]+/).map((function(e){return e.split(/: /)})).forEach((function(e){t[e[0].trim()]=e[1].trim()})),t}var v=function(e,t){var n=o({},e),r={statusCode:t.status,headers:m(t)};return Object.defineProperty(n,"$ResponseMetadata",{value:r,enumerable:!1,writable:!1}),n},b=function(e){return new Promise((function(t,n){var r=new XMLHttpRequest;r.timeout=6e4,r.open("GET",e),r.ontimeout=function(e){return n(c)},r.onerror=function(){return n(f)},r.onload=function(){if(200!==r.status)return n(d);try{var e=JSON.parse(r.responseText),o={signature:e.signature,expire:e.expire,token:e.token};return o.signature&&o.expire&&o.token?t(o):n(d)}catch(e){return n(d)}},r.send()}))},w=function(e,t){return new Promise((function(n,r){e.open("POST","https://upload.imagekit.io/api/v1/files/upload"),e.onerror=function(e){return r(y)},e.onload=function(){if(200===e.status)try{var t=JSON.parse(e.responseText),o=v(t,e);return n(o)}catch(e){return r(e)}else try{t=JSON.parse(e.responseText);var a=v(t,e);return r(a)}catch(e){return r(e)}},e.send(t)}))},x=function(t,n,r,a){if(n.file)if(n.fileName)if(r.authenticationEndpoint)if(r.publicKey){var i,c=new FormData;for(i in n)i&&("file"===i&&"string"!=typeof n.file?c.append("file",n.file,String(n.fileName)):"tags"===i&&Array.isArray(n.tags)?c.append("tags",n.tags.join(",")):"responseFields"===i&&Array.isArray(n.responseFields)?c.append("responseFields",n.responseFields.join(",")):"extensions"===i&&Array.isArray(n.extensions)?c.append("extensions",JSON.stringify(n.extensions)):"customMetadata"!==i||"object"!==e(n.customMetadata)||Array.isArray(n.customMetadata)||null===n.customMetadata?c.append(i,String(n[i])):c.append("customMetadata",JSON.stringify(n.customMetadata)));c.append("publicKey",r.publicKey),function(e,t,n,r){b(n.authenticationEndpoint).then((function(n){t.append("signature",n.signature),t.append("expire",String(n.expire)),t.append("token",n.token),w(e,t).then((function(e){return g(!1,e,r)}),(function(e){return g(!0,e,r)}))}),(function(e){return g(!0,e,r)}))}(t,c,o(o({},r),{},{authenticationEndpoint:r.authenticationEndpoint}),a)}else g(!0,l,a);else g(!0,p,a);else g(!0,u,a);else g(!0,s,a)},O={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig",raw:"raw"},P=["path","query"],k=function(){return"path"},j=function(e){return"query"===e.transformationPosition},T=function(e){return void 0!==e.transformationPosition&&-1!=P.indexOf(e.transformationPosition)},S=function(e){return e&&(O[e]||O[e.toLowerCase()])||""},E=function(){return":"},A=function(){return","},M=function(){return"-"};function I(e){return"string"==typeof e&&"/"==e[e.length-1]&&(e=e.substring(0,e.length-1)),e}function R(e,t){var n=t||"/",r=new RegExp(n+"{1,}","g");return e.join(n).replace(r,n)}var q=function(e){if(!e.path&&!e.src)return"";var t,n,r;try{e.path?(r=new URL(e.urlEndpoint).pathname,t=new URL(R([e.urlEndpoint.replace(r,""),e.path]))):(t=new URL(e.src),n=!0)}catch(e){return console.error(e),""}for(var o in e.sdkVersion&&""!=e.sdkVersion.trim()&&t.searchParams.append("ik-sdk-version",e.sdkVersion.trim()),e.queryParameters)t.searchParams.append(o,String(e.queryParameters[o]));var a=function(e){if(!Array.isArray(e))return"";for(var t=[],n=0,r=e.length;n<r;n++){var o=[];for(var a in e[n]){var i=S(a);if(i||(i=a),"-"===e[n][a])o.push(i);else if("raw"===a)o.push(e[n][a]);else{var s=e[n][a];"oi"!==i&&"di"!==i||(s=(s=I(("string"==typeof(u=s||"")&&"/"==u[0]&&(u=u.slice(1)),u))).replace(/\//g,"@@")),o.push([i,s].join(M()))}}t.push(o.join(A()))}var u;return t.join(E())}(e.transformation);return a&&a.length&&(j(e)||n?t.searchParams.append("tr",a):t.pathname=R(["tr"+E()+a,t.pathname])),t.pathname=R(r?[r,t.pathname]:[t.pathname]),t.href};return function(){function r(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),n(this,"options",{sdkVersion:"javascript-".concat("1.5.1"),publicKey:"",urlEndpoint:"",transformationPosition:k()}),this.options=o(o({},this.options),e||{}),!this.options.urlEndpoint)throw a;if(!T(this.options))throw i}var s,u,p;return s=r,(u=[{key:"url",value:function(e){return t=e,n=this.options,q(o(o({},n),t));var t,n}},{key:"upload",value:function(t,n,r){var a;if("function"==typeof n?a=n:r=n||{},!t||"object"!==e(t))return g(!0,h,a);var i=o(o({},this.options),r),s=(t||{}).xhr;delete t.xhr;var u,p,l=s||new XMLHttpRequest;return(u=this,p=x,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length!==p.length||void 0===t[t.length-1])return new Promise((function(e,n){t.pop(),t.push((function(t){if(t)return n(t);for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];e(o.length>1?o:o[0])})),p.call.apply(p,[u].concat(t))}));if("function"!=typeof t[t.length-1])throw new Error("Callback must be a function.");p.call.apply(p,[u].concat(t))})(l,t,i,a)}}])&&t(s.prototype,u),p&&t(s,p),r}()}));
